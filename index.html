<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Religion Map</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
html, body { margin:0; padding:0; overflow:hidden; background:#f8f8f8; }
svg { width:100vw; height:100vh; display:block; cursor:grab; }
.tooltip { position:absolute; background:rgba(255,255,255,0.9); padding:5px 8px; border-radius:5px; font-size:13px; border:1px solid #ccc; pointer-events:none; }
.controls { position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.9); padding:10px 15px; border-radius:10px; font-family:sans-serif; font-size:14px; pointer-events:auto; cursor:default; z-index:10; }
.controls label { display:block; margin-bottom:4px; }
.controls .sub-options { margin-top:4px; padding-left:16px; }
</style>
</head>
<body>

<div class="controls">
  <div>
    <strong>Mode:</strong>
    <div class="mode-option">
      <label><input type="radio" name="mode" value="religion" checked> Religion</label>
      <div class="sub-options"></div>
    </div>
    <div class="mode-option">
      <label><input type="radio" name="mode" value="religious"> Religious</label>
      <div class="sub-options"></div>
    </div>
    <div class="mode-option">
      <label><input type="radio" name="mode" value="regularly"> Regularly</label>
      <div class="sub-options"></div>
    </div>
  </div>
</div>

<div class="tooltip" style="opacity:0;"></div>

<script>
const bgWidth = 3840, bgHeight = 1918;

const colorMaps = {
  religion: { "katholiek":"#1f77b4", "niet gelovig":"#ff7f0e", "niet geintereseerd":"#2ca02c", "iets":"#d62728", default:"#cccccc" },
  religious: { yes:"#2ca02c", no:"#d62728", default:"#cccccc" },
  regularly: { yes:"#1f77b4", no:"#ff7f0e", default:"#cccccc" }
};

let currentMode = "religion";

const svg = d3.select("body").append("svg").attr("viewBox",[0,0,bgWidth,bgHeight]);
const g = svg.append("g");
g.append("image").attr("xlink:href","kepler.png").attr("x",0).attr("y",0).attr("width",bgWidth).attr("height",bgHeight);

const tooltip = d3.select(".tooltip");

// --- Hard-coded data from your CSV ---
const data = [
  { address: "Lauwestraat 53B", religion: "iets", x: 1752.3, y: 413.92, religious: "yes", regularly: "no" },
  { address: "Lauwestraat 53A", religion: "katholiek", x: 1763.99, y: 397.85, religious: "yes", regularly: "no" },
  { address: "Lauwestraat 51", religion: "niet gelovig", x: 1780.07, y: 358.32, religious: "no", regularly: "no" },
  { address: "Lauwestraat 47", religion: "niet gelovig", x: 1788.76, y: 348.66, religious: "no", regularly: "no" },
  { address: "Lauwestraat 34", religion: "niet gelovig", x: 1773.33, y: 304.49, religious: "no", regularly: "no" },
  { address: "Lauwestraat 31", religion: "katholiek", x: 1820.82, y: 314.77, religious: "yes", regularly: "no" },
  { address: "Lauwestraat 32", religion: "niet geintereseerd", x: 1794.33, y: 282.67, religious: "no", regularly: "no" },
  { address: "Lauwestraat 29", religion: "niet geintereseerd", x: 1822.65, y: 303.51, religious: "no", regularly: "no" },
  { address: "Lauwestraat 27", religion: "katholiek", x: 1831.65, y: 305.4, religious: "yes", regularly: "no" },
  { address: "Lauwestraat 25", religion: "niet gelovig", x: 1833.25, y: 293.79, religious: "no", regularly: "no" },
  { address: "Lauwestraat 23", religion: "katholiek", x: 1834.97, y: 289.13, religious: "yes", regularly: "no" },
  { address: "Hans Van Wervekestraat 16", religion: "katholiek", x: 1905.9, y: 246.8, religious: "yes", regularly: "yes" },
  { address: "Hans Van Wervekestraat 14", religion: "katholiek", x: 1907.22, y: 256.58, religious: "yes", regularly: "yes" },
  { address: "Lauwestraat 9", religion: "niet geintereseerd", x: 1925.92, y: 287.61, religious: "no", regularly: "no" },
  { address: "Hans Van Wervekestraat 1A", religion: "niet geintereseerd", x: 1915.98, y: 300.63, religious: "no", regularly: "no" },
  { address: "Hans Van Wervekestraat 1B", religion: "niet geintereseerd", x: 1911.37, y: 304.55, religious: "no", regularly: "no" },
  { address: "Hans Van Wervekestraat 8", religion: "niet geintereseerd", x: 1889.54, y: 329.97, religious: "no", regularly: "no" },
  { address: "Hans Van Wervekestraat 13", religion: "niet gelovig", x: 1868.2, y: 358.09, religious: "no", regularly: "no" },
  { address: "Borluutplein 17", religion: "niet geintereseerd", x: 1830.01, y: 395.56, religious: "no", regularly: "no" },
  { address: "Borluutplein 15", religion: "niet gelovig", x: 1835.01, y: 397.56, religious: "no", regularly: "no" },
  { address: "Borluutplein 11", religion: "iets", x: 1841.2, y: 399.86, religious: "yes", regularly: "no" },
  { address: "Borluutplein 2", religion: "niet gelovig", x: 1893.7, y: 434.24, religious: "no", regularly: "no" },
  { address: "Borluutplein 10", religion: "niet geintereseerd", x: 1894.02, y: 379.67, religious: "no", regularly: "no" },
  { address: "Borluutplein 5", religion: "niet geintereseerd", x: 1855.26, y: 435.7, religious: "no", regularly: "no" },
  { address: "Borluutstraat 18", religion: "niet geintereseerd", x: 1921.81, y: 411.79, religious: "no", regularly: "no" },
  { address: "Borluutstraat 16", religion: "niet gelovig", x: 1927.06, y: 409.01, religious: "no", regularly: "no" },
  { address: "Borluutstraat 9", religion: "niet geintereseerd", x: 1962.03, y: 407.45, religious: "no", regularly: "no" },
  { address: "Loofblomme straat 65", religion: "niet geintereseerd", x: 1976.98, y: 316.28, religious: "no", regularly: "no" },
  { address: "Loofblomme straat 67", religion: "niet gelovig", x: 1972.7, y: 310.66, religious: "no", regularly: "no" }
];

// --- Rest of your code ---
(() => {
  const controls = d3.select(".controls");

  const delaunay = d3.Delaunay.from(data,d=>d.x,d=>d.y);
  const voronoi = delaunay.voronoi([0,0,bgWidth,bgHeight]);

  function safeRenderCell(i){try{const path=voronoi.renderCell(i);return(!path||path.includes("NaN"))?null:path}catch{return null}}

  const cells = g.selectAll("path").data(data).join("path")
    .attr("d",(_,i)=>safeRenderCell(i))
    .attr("stroke","#333")
    .attr("stroke-width",0.3)
    .on("mousemove",(event,d)=>tooltip.style("opacity",1)
      .style("left",(event.pageX+12)+"px")
      .style("top",(event.pageY-10)+"px")
      .html(`<b>${d.religion}</b><br>${d.address}<br>Religious: ${d.religious}<br>Regular: ${d.regularly}`))
    .on("mouseout",()=>tooltip.style("opacity",0));

  const points = g.selectAll("circle").data(data).join("circle")
    .attr("cx",d=>d.x)
    .attr("cy",d=>d.y)
    .attr("stroke","#000")
    .attr("stroke-width",0.5)
    .attr("r",6);

  function buildCheckboxes() {
    d3.selectAll(".sub-options").selectAll("label").remove();

    const subDiv = d3.select(`input[name='mode'][value='${currentMode}']`).node().closest('.mode-option');
    const subOptionsDiv = d3.select(subDiv).select(".sub-options");

    const values = [...new Set(data.map(d => (d[currentMode] || "").trim().toLowerCase()))].sort();
    values.forEach(v => {
      const label = subOptionsDiv.append("label");
      label.append("input")
        .attr("type", "checkbox")
        .attr("checked", true)
        .attr("value", v)
        .on("change", update);
      label.append("span").text(" " + v);
    });

    d3.selectAll(".mode-option .sub-options").style("display", "none");
    subOptionsDiv.style("display", "block");
  }

  function update() {
    const subDiv = d3.select(`input[name='mode'][value='${currentMode}']`).node().closest('.mode-option');
    const subOptionsDiv = d3.select(subDiv).select(".sub-options");

    const active = new Set(subOptionsDiv.selectAll("input:checked").nodes().map(d => d.value.trim().toLowerCase()));
    const cmap = colorMaps[currentMode];

    cells.attr("display", d => active.has((d[currentMode] || "").trim().toLowerCase()) ? null : "none")
         .attr("fill", d => cmap[(d[currentMode] || "").trim().toLowerCase()] || cmap.default)
         .attr("fill-opacity",0.5);

    points.attr("display", d => active.has((d[currentMode] || "").trim().toLowerCase()) ? null : "none")
          .attr("fill", d => cmap[(d[currentMode] || "").trim().toLowerCase()] || cmap.default);
  }

  buildCheckboxes();
  update();

  controls.selectAll("input[name='mode']").on("change", function() {
    currentMode = this.value;
    buildCheckboxes();
    update();
  });
})();

const viewportHeight = window.innerHeight;
const maxZoom = viewportHeight / bgHeight;

const zoom = d3.zoom()
  .scaleExtent([1, maxZoom])
  .translateExtent([[0,0],[bgWidth,bgHeight]])
  .on("zoom", event => g.attr("transform", event.transform));

svg.call(zoom);

</script>

</body>
</html>
